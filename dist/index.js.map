{"version":3,"sources":["../src/api/http.constants.ts","../src/api/http.factory.ts","../src/errors/errors.constants.ts","../src/errors/errors.handler.ts","../src/hmac/hmac.constants.ts","../src/hmac/hmac.encryption.ts","../src/hmac/hmac.methods.ts","../src/hono/hono.merge.ts"],"sourcesContent":["// Pick from generally accepted HTTP status codes, meanings: (https://i.pinimg.com/originals/2c/0c/43/2c0c43e5bacbdb5f1ed7d18bf4ced2e7.jpg)\nexport const SUCCESS_STATUS_CODES = [200, 201, 202, 307] as const;\nexport const EXCEPTION_STATUS_CODES = [400, 401, 403, 404, 405, 409, 500] as const;\n","import type { APIError, APISuccess, ExceptionStatusCode, SuccessStatusCode } from './http.schemas';\n\nexport function success<T = unknown>({ status, data }: { status: SuccessStatusCode; data: T }): APISuccess<T> {\n  // Fabric for creating successful API responses (avoiding writing { success: true })\n  return { ok: true, status, data };\n}\n\nexport function voidSuccess({ status }: { status: SuccessStatusCode }): APISuccess<void> {\n  // Fabric for creating successful API responses with no data (avoiding writing { success: true })\n  return { ok: true, status, data: undefined };\n}\n\nexport function failure({ status, error }: { status: ExceptionStatusCode; error: string }): APIError {\n  // Fabric for creating error API responses (avoiding writing { success: false })\n  return { ok: false, status, error };\n}\n","// Define constants related to errors and their messages\n\nexport const DEFAULT_INTERNAL_ERROR = 'Internal server error';\n","import { failure } from '@/api/http.factory';\nimport type { APIError } from '@/api/http.schemas';\n\nimport { DEFAULT_INTERNAL_ERROR } from './errors.constants';\nimport type { HandlerError } from './errors.schemas';\n\nexport function createErrorHandler(registries: HandlerError[]) {\n  // Handles typed (HandlerError) errors gracefully,\n  // returning appropriate HTTP status codes and error messages\n\n  return {\n    error(error: Error): APIError {\n      for (const registry of registries) {\n        for (const { httpCode, Exception } of Object.values(registry)) {\n          if (error instanceof Exception) return failure({ status: httpCode, error: error.message });\n        }\n      }\n      return failure({ status: 500, error: DEFAULT_INTERNAL_ERROR });\n    },\n  };\n}\n","// Constants for HMAC protocol\nexport const HMAC_SIGNATURE_HEADER_NAME = 'X-HMAC-Signature';\nexport const HMAC_TIMESTAMP_HEADER_NAME = 'X-HMAC-Timestamp';\n","import { createHmac } from 'crypto';\n\nexport function signDataWithHMAC(HMACSecret: string, data: string = ''): { timestamp: string; signature: string } {\n  // Signs an HMAC request using the provided HMAC secret and request body and\n  // returns an object containing the timestamp and signature for assigning to headers\n\n  const timestamp = Date.now().toString();\n  const payload = `${timestamp}.${data}`;\n  const signature = createHmac('sha256', HMACSecret).update(payload).digest('hex');\n\n  return { timestamp, signature };\n}\n\nexport function verifyHMACSignature(HMACSecret: string, data: string, timestamp: string, signature: string): boolean {\n  const expectedSignature = createHmac('sha256', HMACSecret).update(`${timestamp}.${data}`).digest('hex');\n  return signature === expectedSignature;\n}\n","import type { KyRequest } from 'ky';\n\nimport { HMAC_SIGNATURE_HEADER_NAME, HMAC_TIMESTAMP_HEADER_NAME } from './hmac.constants';\nimport { signDataWithHMAC } from './hmac.encryption';\n\nasync function signKyRequestWithHMAC(request: KyRequest, HMACSecret: string) {\n  // Signing ky request with HMAC and setting relevant headers\n\n  const requestClone = request.clone();\n  const bodyClone = await requestClone.text();\n\n  const { timestamp, signature } = signDataWithHMAC(HMACSecret, bodyClone);\n  request.headers.set(HMAC_TIMESTAMP_HEADER_NAME, timestamp);\n  request.headers.set(HMAC_SIGNATURE_HEADER_NAME, signature);\n}\n\nexport { signKyRequestWithHMAC };\n","import { Hono } from 'hono';\nimport type { BlankEnv } from 'hono/types';\n\nexport type MergeHonoSchemas<R extends readonly Hono<any, any, any>[]> = {\n  [K in R[number] as K extends Hono<any, infer Schema, any> ? keyof Schema : never]: K extends Hono<any, infer Schema, any>\n    ? Schema[keyof Schema]\n    : never;\n};\n\nexport function mergeHonoRouters<const R extends readonly Hono<any, any, any>[]>(\n  options: { before?: ((app: Hono) => void)[] } | undefined,\n  ...routers: R\n): Hono<BlankEnv, MergeHonoSchemas<R>, '/'> {\n  // Merges independent routers into a single router, with, most importantly, the ability to merge schemas,\n  // that is absolutely necessary for building contracts for external usage on hono-client\n\n  const app = new Hono();\n  if (options?.before) for (const hook of options.before) hook(app); // Basically, applying middleware in most cases\n  for (const router of routers) app.route('', router); // Injecting routers into the app\n  return app as Hono<BlankEnv, MergeHonoSchemas<R>, '/'>;\n}\n"],"mappings":";AACO,IAAM,uBAAuB,CAAC,KAAK,KAAK,KAAK,GAAG;AAChD,IAAM,yBAAyB,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,GAAG;;;ACAjE,SAAS,QAAqB,EAAE,QAAQ,KAAK,GAA0D;AAE5G,SAAO,EAAE,IAAI,MAAM,QAAQ,KAAK;AAClC;AAEO,SAAS,YAAY,EAAE,OAAO,GAAoD;AAEvF,SAAO,EAAE,IAAI,MAAM,QAAQ,MAAM,OAAU;AAC7C;AAEO,SAAS,QAAQ,EAAE,QAAQ,MAAM,GAA6D;AAEnG,SAAO,EAAE,IAAI,OAAO,QAAQ,MAAM;AACpC;;;ACbO,IAAM,yBAAyB;;;ACI/B,SAAS,mBAAmB,YAA4B;AAI7D,SAAO;AAAA,IACL,MAAM,OAAwB;AAC5B,iBAAW,YAAY,YAAY;AACjC,mBAAW,EAAE,UAAU,UAAU,KAAK,OAAO,OAAO,QAAQ,GAAG;AAC7D,cAAI,iBAAiB,UAAW,QAAO,QAAQ,EAAE,QAAQ,UAAU,OAAO,MAAM,QAAQ,CAAC;AAAA,QAC3F;AAAA,MACF;AACA,aAAO,QAAQ,EAAE,QAAQ,KAAK,OAAO,uBAAuB,CAAC;AAAA,IAC/D;AAAA,EACF;AACF;;;ACnBO,IAAM,6BAA6B;AACnC,IAAM,6BAA6B;;;ACF1C,SAAS,kBAAkB;AAEpB,SAAS,iBAAiB,YAAoB,OAAe,IAA8C;AAIhH,QAAM,YAAY,KAAK,IAAI,EAAE,SAAS;AACtC,QAAM,UAAU,GAAG,SAAS,IAAI,IAAI;AACpC,QAAM,YAAY,WAAW,UAAU,UAAU,EAAE,OAAO,OAAO,EAAE,OAAO,KAAK;AAE/E,SAAO,EAAE,WAAW,UAAU;AAChC;AAEO,SAAS,oBAAoB,YAAoB,MAAc,WAAmB,WAA4B;AACnH,QAAM,oBAAoB,WAAW,UAAU,UAAU,EAAE,OAAO,GAAG,SAAS,IAAI,IAAI,EAAE,EAAE,OAAO,KAAK;AACtG,SAAO,cAAc;AACvB;;;ACXA,eAAe,sBAAsB,SAAoB,YAAoB;AAG3E,QAAM,eAAe,QAAQ,MAAM;AACnC,QAAM,YAAY,MAAM,aAAa,KAAK;AAE1C,QAAM,EAAE,WAAW,UAAU,IAAI,iBAAiB,YAAY,SAAS;AACvE,UAAQ,QAAQ,IAAI,4BAA4B,SAAS;AACzD,UAAQ,QAAQ,IAAI,4BAA4B,SAAS;AAC3D;;;ACdA,SAAS,YAAY;AASd,SAAS,iBACd,YACG,SACuC;AAI1C,QAAM,MAAM,IAAI,KAAK;AACrB,MAAI,SAAS,OAAQ,YAAW,QAAQ,QAAQ,OAAQ,MAAK,GAAG;AAChE,aAAW,UAAU,QAAS,KAAI,MAAM,IAAI,MAAM;AAClD,SAAO;AACT;","names":[]}